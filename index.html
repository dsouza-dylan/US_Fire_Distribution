<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>US Fire Distribution (2024)</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>

<style>
html,body {height:100%; margin:0; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
body {background:#0f0f0f; color:#fff; display:flex; flex-direction:column; align-items:center; transition: background 0.3s, color 0.3s;}
body.light-mode {background:#fafafa; color:#111;}

h1#map-title {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  margin: 0;
  font-weight: 700;
  font-size: 2.2rem;
  color: #fff;
  width: 100%;
  background: #1a1a1e;
  padding: 16px 0 12px 0;
  box-shadow: 0 2px 6px rgba(0,0,0,0.5);
  transition: background 0.3s, color 0.3s;
  position: relative;
}

body.light-mode h1#map-title {
  background: #ececec;
  color: #1a1a1e;
}

.header{
  background-color: #1a1a1e;
}

.header-controls {
  display: flex;
  width: 100%;
  align-items: center;
  justify-content: center;
  position: relative;
}

.center-controls {
  display: flex;
  align-items: center;
  gap: 12px;
}

.header-right {
  position: absolute;
  top: 50%;
  right: 80px;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  z-index: 100;
}

main {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  width: 100%;
  min-height: 0;
  margin-top: 0;
}

#map-wrap {
  flex:1; 
  position:relative; 
  background:#1a1a1e; 
  display:flex; 
  flex-direction:column; 
  justify-content:center; 
  align-items:center; 
  width:100%; 
  transition: background 0.3s;
}

body.light-mode #map-wrap {background:#ececec;}

svg {max-width:100%; max-height:100%; display:block;}

.state { stroke:#1a1a1a; stroke-width:1.5; cursor:pointer; transition:all 0.2s; }
.state:hover { opacity:0.85; stroke:#ff6b35; stroke-width:2; }

.county { stroke:#1a1a1a; stroke-width:0.6; cursor:pointer; transition: all 0.2s; }
.county:hover { opacity:0.85; stroke:#ff6b35; stroke-width:2; }

.tooltip {
  position:absolute; pointer-events:none; background:rgba(0,0,0,0.95); backdrop-filter:blur(10px); color:#fff;
  padding:10px 14px; border-radius:8px; font-size:0.85rem; opacity:0; transform:translate(-50%,-120%);
  transition:opacity 120ms ease; white-space:nowrap; z-index:100; border:1px solid #333; box-shadow:0 4px 20px rgba(0,0,0,0.5);
}

body.light-mode .tooltip {
  background:rgba(255,255,255,0.95); color:#111; border:1px solid #ccc;
}

.tooltip.show {opacity:1;}

footer {
  width: 100vw; left: 0; right: 0; background: #1a1a1e; color: #ff6b35; display: flex; justify-content: center; align-items: center;
  position: fixed; bottom: 0; z-index: 50; padding: 30px 0; transition: background 0.3s, color 0.3s;
}

body.light-mode footer { background: #ececec; color: #ff6b35; }

.bottom-navbar { display: flex; gap: 16px; align-items: center; justify-content: center; }
.slider-wrap { display: flex; align-items: center; gap: 12px; }

#month-range-bottom { width:350px; height:6px; background:#2a2a2a; border-radius:3px; outline:none; -webkit-appearance:none;}
#month-range-bottom::-webkit-slider-thumb { -webkit-appearance:none; width:16px; height:16px; background:#ff6b35; border-radius:50%; cursor:pointer; transition:all 0.2s;}
#month-range-bottom::-webkit-slider-thumb:hover { background:#ff8c5a; transform:scale(1.1); }
#month-range-bottom::-moz-range-thumb { width:16px; height:16px; background:#ff6b35; border-radius:50%; cursor:pointer; border:none; }

#month-label-bottom {color:#fff;}
body.light-mode #month-label-bottom {color:#111;}

.mode-toggle {
  background: #fff; color: #000; border: 1px solid #333; border-radius: 50%; width: 40px; height: 40px;
  cursor: pointer; font-size: 1.3rem; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.3); padding:0;
}

body.light-mode .mode-toggle {
  background: #000; color: #fff; border: 1px solid #ccc; box-shadow: 0 2px 8px rgba(255,255,255,0.2);
}

.mode-toggle:hover { transform: scale(1.1); }

.back-us-btn {
  padding: 10px 18px;
  border-radius: 999px;
  background: linear-gradient(135deg, #ff6b35, #ff8c5a);
  color: #fff;
  font-weight: 600;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  font-size: 0.95rem;
  cursor: pointer;
  box-shadow: 0 4px 16px rgba(0,0,0,0.4);
  border: none;
  transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
  z-index: 100;
  display: none;
}

.back-us-btn:hover {
  transform: scale(1.08);
  box-shadow: 0 6px 20px rgba(0,0,0,0.5);
  background: linear-gradient(135deg, #ff7b50, #ffa16f);
}

body.light-mode .back-us-btn {
  background: linear-gradient(135deg, #ff6b35, #ff8c5a);
  color: #fff;
}

@media(max-width:900px){ 
  #month-range-bottom {width:140px;} 
  .header-right { position: static; transform: none; margin-top: 12px; }
  h1#map-title { padding: 12px; background-color: #1a1a1e;}
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.legend {
  font-family: sans-serif;
  background: rgba(10, 10, 10, 0.9);
  backdrop-filter: blur(10px);
  color: #fff;
  padding: 12px 16px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.5);
  width: 160px;
  position: absolute;
  right: 24px;
  top: 50%;
  transform: translateY(-50%);
  z-index: 10;
  border: 1px solid #333;
  transition: background 0.3s, color 0.3s, border 0.3s;
}

body.light-mode .legend {
  background: rgba(255, 255, 255, 0.9);
  color: #111;
  border: 1px solid #ccc;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.legend h3 {
  font-size: 14px;
  margin: 0 0 8px;
  font-weight: 600;
}

.legend-item {
  display: flex;
  align-items: center;
  font-size: 13px;
  margin-bottom: 4px;
}

.legend-item span {
  width: 18px;
  height: 18px;
  border-radius: 3px;
  margin-right: 8px;
  border: 1px solid #ccc;
}

body.light-mode #map-description { color: #000; }
body.light-mode p,
body.light-mode .legend h3,
body.light-mode .legend-item,
body.light-mode .tooltip {
  color: #111 !important;
}

.debug-info {
  position: fixed;
  bottom: 100px;
  left: 10px;
  background: rgba(0,0,0,0.8);
  color: #fff;
  padding: 10px;
  border-radius: 4px;
  font-size: 12px;
  font-family: monospace;
  z-index: 1000;
  max-width: 300px;
  display: none;
}

body.light-mode .debug-info {
  background: #ececec;
  color: #111;
  border: 1px solid #ccc;
}

.caption {
  max-width: 900px;
  margin: 15px auto;
  margin-top: 5px;
  padding: 0 30px;
  text-align: center;
  font-size: 1rem;
  line-height: 1.6;
  color: #fff;
}

body.light-mode .caption {
  color: #111;
}

</style>
</head>
<body>

<h1 id="map-title">
  United States: Active Fires (2024)
  <div class="header-controls">
    <div class="center-controls">
      <div id="loading-spinner" style="
        width: 25px;
        height: 25px;
        border: 3px solid rgba(255,255,255,0.3);
        border-top: 3px solid #ff6b35;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        display: none;
      "></div>

      <div id="state-control">
        <button id="back-us" class="back-us-btn" style="display:none;">‚¨Ö US Map</button>
      </div>
    </div>

    <div class="header-right">
      <button class="mode-toggle" id="mode-toggle" aria-label="Toggle theme">
        <span class="icon">‚òÄÔ∏è</span>
      </button>
    </div>
  </div>
</h1>

<main>
<div id="map-wrap">
  <div class="caption"">Explore 2024 US fires from NASA MODIS data. Scroll down for details or click a state to explore.<br><em>Total FRP (Fire Radiation Power) measures the sum of energy in megawatts (MW) released by fires in a month.</em></div>
  <svg id="map"></svg>
  <div class="tooltip" id="tooltip"></div>
  <div class="debug-info" id="debug-info">Debug info will appear here</div>
</div>
<div id="legend-state" class="legend">
  <h3>Total FRP (MW)</h3>
  <div class="legend-item"><span style="background:#fffaf5"></span>0</div>
  <div class="legend-item"><span style="background:#ffebd6"></span>0 ‚Äì 1,000</div>
  <div class="legend-item"><span style="background:#ffc999"></span>1,000 ‚Äì 10,000</div>
  <div class="legend-item"><span style="background:#ff9c52"></span>10,000 ‚Äì 100,000</div>
  <div class="legend-item"><span style="background:#f97316"></span>100,000 ‚Äì 500,000</div>
  <div class="legend-item"><span style="background:#b54700"></span>500,000+</div>
</div>
<div id="legend-county" class="legend" style="display:none;">
  <h3>Total FRP (MW)</h3>
  <div class="legend-item"><span style="background:#fffaf5"></span>0</div>
  <div class="legend-item"><span style="background:#ffebd6"></span>0 ‚Äì 500</div>
  <div class="legend-item"><span style="background:#ffc999"></span>500 ‚Äì 1,500</div>
  <div class="legend-item"><span style="background:#ff9c52"></span>1,500 ‚Äì 40,000</div>
  <div class="legend-item"><span style="background:#f97316"></span>40,000 ‚Äì 100,000</div>
  <div class="legend-item"><span style="background:#b54700"></span>100,000+</div>
</div>
<section id="map-description" style="max-width:900px; padding-bottom: 100px; margin:40px auto; font-size:1rem; line-height:1.6;">
    <p>After examination of the data provided by NASA's MODIS, we discovered interesting geospatial data relating to fires in the United States that were detected by Terra and Aqua satellites. We were able to pull data from 2024 geographically located in the United States, with features like fire confidence level, day or night, brightness, date, and geolocation. Due to the nature of the geospatial data we were able to implement an interactive geographic map displaying wildfire count with different filters. We determined that the count of fires was the most robust feature to use compared to brightness, and the user may not be able to interpret brightness as satellite cloud cover can skew the brightness of detected fires.</p>

    <p>Upon understanding the information that we wanted to use, we brainstormed ways to show the information, such as an interactive bar plot or map, ultimately going with the map since we wanted to directly communicate where the fires were happening. We debated focusing on one state for the sake of memory and static webpage performance, but after filtering the data in pandas we discovered that we were able to get a dataset of the full year that worked on the static webpage without any performance issues, by using separate state-level CSV files to improve loading performance and reduce initial page weight.</p>

    <p>The design of the visualization included the following elements: an orange theme to represent fire intuitively, a heatmap system with varying color intensities to represent density of detected fires, a simple tooltip showing county or state name and number of fires, support for both light and dark mode, a scrollable month selector with months shortened to three-letter abbreviations to improve responsiveness, the ability to zoom into a specific state for more localized analysis, a back button to return to the overview of the United States, a loading indicator since some states take longer to load due to dataset size, a default month of October 2024 which was chosen because it contains a good distribution of wildfire events, the use of a geographic map as the primary visualization combined with D3 functions for state and county segmentation using latitude and longitude. These design decisions were made to balance clarity, usability, and performance. The orange color palette and heatmap gradients were chosen because they naturally communicate the concept of fire intensity and frequency. The map-based layout was preferred over bar plots because geographic context is essential when discussing wildfires and it makes spatial patterns immediately visible. The simplified tooltip, scroller, and zoom-in functionality were included to avoid overwhelming users with data while still making deeper exploration accessible. Together, these decisions created an interface that is intuitive, visually coherent, and efficient for exploring geospatial wildfire data.</p>
  </section>
</main>

<footer>
  <div class="bottom-navbar">
    <div class="slider-wrap">
      <label for="month-range-bottom" style="font-size:1rem; font-weight:700;">Month:</label>
      <input id="month-range-bottom" type="range" min="1" max="12" step="1" value="10">
      <div id="month-label-bottom" style="min-width:46px; text-align:left; font-weight:600;">Oct</div>
    </div>
  </div>
</footer>

<script>
const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const STATE_NAMES = {
  '01':'alabama','02':'alaska','04':'arizona','05':'arkansas','06':'california','08':'colorado',
  '09':'connecticut','10':'delaware','12':'florida','13':'georgia','15':'hawaii','16':'idaho',
  '17':'illinois','18':'indiana','19':'iowa','20':'kansas','21':'kentucky','22':'louisiana',
  '23':'maine','24':'maryland','25':'massachusetts','26':'michigan','27':'minnesota','28':'mississippi',
  '29':'missouri','30':'montana','31':'nebraska','32':'nevada','33':'new_hampshire','34':'new_jersey',
  '35':'new_mexico','36':'new_york','37':'north_carolina','38':'north_dakota','39':'ohio','40':'oklahoma',
  '41':'oregon','42':'pennsylvania','44':'rhode_island','45':'south_carolina','46':'south_dakota',
  '47':'tennessee','48':'texas','49':'utah','50':'vermont','51':'virginia','53':'washington',
  '54':'west_virginia','55':'wisconsin','56':'wyoming'
};

const WIDTH = window.innerWidth;
const HEIGHT = window.innerHeight - 140;
const svg = d3.select('#map').attr('width', WIDTH).attr('height', HEIGHT);
const g = svg.append('g');
const tooltip = d3.select('#tooltip');
const debugInfo = d3.select('#debug-info');

let statesData=null, countiesData=null, usMonthlySummary={}, currentMode='us', currentStateName=null, currentStateData=[], currentStateCounties=[], monthlyFireData={};
let projection = d3.geoAlbersUsa().translate([WIDTH/2, HEIGHT/2]).scale(1000);
let path = d3.geoPath().projection(projection);

const backButton = document.getElementById('back-us');

function getStateBucketColor(count) {
  if (count === 0) return '#fffaf5';
  if (count <= 50) return '#ffebd6';
  if (count <= 200) return '#ffc999';
  if (count <= 500) return '#ff9c52';
  if (count <= 1500) return '#f97316';
  return '#b54700';
}

function getCountyBucketColor(count) {
  if (count === 0) return "#fffaf5";
  if (count <= 5) return "#ffebd6";
  if (count <= 25) return "#ffc999";
  if (count <= 100) return "#ff9c52";
  if (count <= 500) return "#f97316";
  return "#b54700";
}

  function getStateFRPColor(frp) {
  if (frp === 0) return '#fffaf5';
  if (frp <= 1000) return '#ffebd6';
  if (frp <= 10000) return '#ffc999';
  if (frp <= 100000) return '#ff9c52';
  if (frp <= 500000) return '#f97316';
  return '#b54700';
}

function getCountyFRPColor(frp) {
  if (frp === 0) return '#fffaf5';
  if (frp <= 500) return '#ffebd6';
  if (frp <= 1500) return '#ffc999';
  if (frp <= 40000) return '#ff9c52';
  if (frp <= 100000) return '#f97316';
  return '#b54700';
}

function toggleBackButton(show) {
  backButton.style.display = show ? 'inline-flex' : 'none';
}

function updateDebugInfo(text) {
  debugInfo.html(text);
  console.log(text);
}

backButton.addEventListener('click',()=>{ drawUSView(+monthRangeBottom.value); });

Promise.all([
  d3.json('https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json'),
  d3.json('https://cdn.jsdelivr.net/npm/us-atlas@3/counties-10m.json'),
  d3.csv('us_summary_2024_monthly.csv')
]).then(([statesJson, countiesJson, summaryCsv])=>{
  statesData = topojson.feature(statesJson, statesJson.objects.states).features;
  countiesData = topojson.feature(countiesJson, countiesJson.objects.counties).features;
  
  summaryCsv.forEach(row=>{
    const state = row.state.toLowerCase();
    const month = +row.month;
    if(!usMonthlySummary[state]) usMonthlySummary[state]={};
    usMonthlySummary[state][month]={
      count: +row.fire_count, 
      brightness: +row.total_brightness,
      frp: +row.total_frp
    };
  });
  
  drawUSView(10);
  monthRangeBottom.value = 10;
  monthLabelBottom.textContent = MONTHS[9];
}).catch(err => {
  console.error('Error loading initial data:', err);
  alert('Failed to load map data: ' + err.message);
});

function drawUSView(monthNum=1){
  currentMode='us'; 
  currentStateName=null;
  toggleBackButton(false);
  
  projection = d3.geoAlbersUsa(); 
  path=d3.geoPath().projection(projection);
  const usFeature={type:"FeatureCollection", features:statesData};
  projection.fitSize([WIDTH, HEIGHT * 0.9], usFeature);
  
  g.transition().duration(750).attr('transform','translate(0,0) scale(1)');
  g.selectAll('*').remove();

  const stateFireData={};
  Object.keys(STATE_NAMES).forEach(fips=>{
    const stateName = STATE_NAMES[fips];
    const data = usMonthlySummary[stateName]?.[monthNum] || {count:0};
    stateFireData[fips]=data.count;
  });

  g.append('g').attr('id','states')
    .selectAll('path')
    .data(statesData)
    .enter()
    .append('path')
    .attr('class','state')
    .attr('d',path)
    .attr('fill', d => {
      const fips = String(d.id).padStart(2, '0');
      const stateName = STATE_NAMES[fips]; 
      const stateData = usMonthlySummary[stateName]?.[monthNum] || {count:0, frp:0};
      return getStateFRPColor(stateData.frp || 0);
    })
    .on('mouseover',(event,d)=>{
      const fips=String(d.id).padStart(2,'0'); 
      const stateName=STATE_NAMES[fips];
      const stateData = usMonthlySummary[stateName]?.[monthNum] || {count:0, frp:0};
      const fires = stateData.count || 0;
      const frp = stateData.frp || 0;
      tooltip.html(`<div style="font-weight:700">${stateName.replace(/_/g,' ').replace(/\b\w/g,c=>c.toUpperCase())}</div>
                    <div>${fires.toLocaleString()} fires (${MONTHS[monthNum-1]})</div>
                    <div>Total FRP: ${frp.toLocaleString()} MW</div>`)
        .style('left', event.pageX+'px')
        .style('top', event.pageY+'px')
        .classed('show', true);
    })
    .on('mouseout',()=>tooltip.classed('show',false))
    .on('click',(event,d)=>{
      if(currentMode === 'state') return;
      const fips=String(d.id).padStart(2,'0'); 
      const stateName=STATE_NAMES[fips];
      zoomToState(fips,stateName);
    });
    
  showStateLegend();
}

async function zoomToState(stateFips, stateName){
  const spinner = document.getElementById('loading-spinner');
  spinner.style.display = 'block';
  updateDebugInfo(`Loading ${stateName}...`);

  try {
    const csvData = await d3.csv(`state_data/${stateName}_2024.csv`);
    
    updateDebugInfo(`Loaded ${csvData.length} rows`);
    
    currentStateData = csvData.map(r => {
      const dateParts = r.acq_date.split('-');
      const year = parseInt(dateParts[0]);
      const month = parseInt(dateParts[1]);
      const day = parseInt(dateParts[2]);
      
      return {
        latitude: parseFloat(r.latitude), 
        longitude: parseFloat(r.longitude), 
        brightness: parseFloat(r.brightness) || 0,
        frp: parseFloat(r.frp) || 0,
        acq_date: r.acq_date,
        month: month
      };
    });

    console.log('Parsed fires:', currentStateData.length);
    console.log('Sample fire:', currentStateData[0]);

    currentMode = 'state'; 
    currentStateName = stateName;
    toggleBackButton(true);
    
    currentStateCounties = countiesData.filter(d => Math.floor(d.id/1000) === parseInt(stateFips));
    
    if(!currentStateCounties.length){
      alert('No county data for this state'); 
      spinner.style.display = 'none';
      return;
    }

    console.log('Counties found:', currentStateCounties.length);

    g.selectAll('#states path')
      .attr('opacity', d => {
        const fips = String(d.id).padStart(2, '0');
        return fips === stateFips ? 1 : 0.3;
      })
      .style('pointer-events', d => {
        const fips = String(d.id).padStart(2, '0');
        return fips === stateFips ? 'auto' : 'none';
      });
    
    precomputeMonthlyFireData();
    
    const currentMonth = parseInt(monthRangeBottom.value);
    drawCountyHeatmap(currentMonth);

    const bounds = path.bounds({type:"FeatureCollection", features:currentStateCounties});
    const dx = bounds[1][0] - bounds[0][0]; 
    const dy = bounds[1][1] - bounds[0][1];
    const x = (bounds[0][0] + bounds[1][0]) / 2; 
    const y = (bounds[0][1] + bounds[1][1]) / 2;
    const scale = 0.75 * Math.min(WIDTH/dx, HEIGHT/dy);
    const translate = [WIDTH/2 - scale*x, HEIGHT/2 - scale*y];
    
    g.transition().duration(750).attr('transform',`translate(${translate}) scale(${scale})`);
    
    showCountyLegend();

  } catch(err){
    console.error('Error loading state data:', err);
    alert("Failed to load state data: " + err.message);
    updateDebugInfo(`Error: ${err.message}`);
  } finally {
    spinner.style.display = 'none';
  }
}

const monthRangeBottom = document.getElementById('month-range-bottom');
const monthLabelBottom = document.getElementById('month-label-bottom');

monthRangeBottom.addEventListener('input', () => {
  const monthNum = parseInt(monthRangeBottom.value);
  monthLabelBottom.textContent = MONTHS[monthNum - 1];
  if (currentMode === 'state') {
    drawCountyHeatmap(monthNum);
  } else {
    drawUSView(monthNum);
  }
});

function precomputeMonthlyFireData(){
  monthlyFireData = {};
  monthlyFRPData = {}; // new object to store FRP

  currentStateCounties.forEach(c => {
    monthlyFireData[c.id] = Array(12).fill(0);
    monthlyFRPData[c.id] = Array(12).fill(0); // initialize FRP array
  });

  let matchedFires = 0;
  let unmatchedFires = 0;

  currentStateData.forEach(fire => {
    let matched = false;

    for(let i = 0; i < currentStateCounties.length; i++) {
      const county = currentStateCounties[i];
      try {
        if(d3.geoContains(county, [fire.longitude, fire.latitude])) {
          monthlyFireData[county.id][fire.month - 1]++;
          monthlyFRPData[county.id][fire.month - 1] += fire.frp || 0; // accumulate FRP
          matchedFires++;
          matched = true;
          break;
        }
      } catch(e) {
        // silently continue
      }
    }

    if(!matched) {
      unmatchedFires++;
    }
  });

  const debugText = `Fires: ${currentStateData.length}<br>Matched: ${matchedFires}<br>Unmatched: ${unmatchedFires}<br>Counties: ${currentStateCounties.length}`;
  updateDebugInfo(debugText);
}


function drawCountyHeatmap(monthNum){
  if(!currentStateCounties.length) return;

  currentStateCounties.forEach(c => {
    c.fireValue = monthlyFireData[c.id]?.[monthNum-1] || 0;
  });
  
  const maxValue = d3.max(currentStateCounties, d => d.fireValue) || 1;
  console.log(`Drawing heatmap for month ${monthNum}, max fires: ${maxValue}`);

  g.select('#counties').remove();

  g.append('g')
    .attr('id','counties')
    .selectAll('path')
    .data(currentStateCounties)
    .join('path')
    .attr('class','county')
    .attr('d', path)
    .attr('fill', d => {
      const frp = monthlyFRPData[d.id]?.[monthNum-1] || 0;
      const color = getCountyFRPColor(frp);
      return color;
    })
    .on('mouseover', (event, d) => {
      const countyName = d.properties?.name || 'Unknown';
      const fires = monthlyFireData[d.id]?.[monthNum-1] || 0;
      const frp = monthlyFRPData[d.id]?.[monthNum-1] || 0;

      tooltip.html(`<div style="font-weight:700">${countyName} County</div>
                    <div>${fires.toLocaleString()} fires (${MONTHS[monthNum-1]})</div>
                    <div>Total FRP: ${frp.toLocaleString()} MW</div>`)
        .style('left', event.pageX + 'px')
        .style('top', event.pageY + 'px')
        .classed('show', true);
    })
    .on('mouseout', () => tooltip.classed('show', false));
}

function showStateLegend() {
  document.getElementById("legend-state").style.display = "block";
  document.getElementById("legend-county").style.display = "none";
}

function showCountyLegend() {
  document.getElementById("legend-state").style.display = "none";
  document.getElementById("legend-county").style.display = "block";
}

const modeToggle = document.getElementById('mode-toggle');
const modeIcon = modeToggle.querySelector('.icon');

modeToggle.addEventListener('click', () => {
  document.body.classList.toggle('light-mode');
  modeIcon.textContent = document.body.classList.contains('light-mode') ? 'üåô' : '‚òÄÔ∏è';
});

// Show debug info temporarily for testing
// debugInfo.style('display', 'block');
</script>

</body>
</html>